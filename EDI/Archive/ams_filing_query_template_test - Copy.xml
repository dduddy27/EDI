<?xml version = '1.0' encoding = 'UTF-8'?>
<dataTemplate name="ams" description="AMS Filing Details" defaultPackage="" version="1.0">
   <properties>
      <property name="xml_tag_case" value="upper"/>
   </properties>

   <parameters>
	  <parameter name="P_GTM_SHIPMENT_ID" dataType="varchar" defaultvalue="SCOULAR/NVO.20140608-00000002"/>
	  <parameter name="P_GTM_CUSTOMS_ID" dataType="varchar" defaultvalue="SCOULAR/NVO.20140608-00000003"/>

	 <!-- <parameter name="P_GTM_SHIPMENT_ID" dataType="varchar" defaultvalue="SCOULAR/BCO.AES_SHIPMENT_RAIL_S5"/> -->
	  <parameter name="P_DOCUMENT_TRACKING_NUMBER" dataType="varchar" defaultValue="123456"/> 
	  <parameter name="P_DOCUMENT_DEF_GID" dataType="varchar" defaultValue="AMS_FILING"/>	  
	  
	  <parameter name="P_TRANSMITTER_ID" dataType="varchar" defaultValue="transmitt"/>
	  <parameter name="P_COMMUNICATION_PASSWORD_ID" dataType="varchar" defaultValue="password"/>	  
	  <parameter name="P_FILER_ID" dataType="varchar" defaultValue="filerid"/>
	  <parameter name="P_IS_PRODUCTION" dataType="varchar" defaultValue="N"/>
	  
	  <parameter name="P_REPORTING_QUANTITY" dataType="varchar" defaultValue="ORDERED"/>
	  <parameter name="P_REPORTING_CURRENCY" dataType="varchar" defaultValue="TOTAL VALUE"/>
	  <parameter name="P_REPORTING_REFERENCE_NUMBER" dataType="varchar" defaultValue="BN"/>
	  <parameter name="P_REPORTING_FOREIGN_ENTITY" dataType="varchar" defaultValue="entity"/>	  
	  <parameter name="P_REPORTING_TIMEZONE" dataType="varchar" defaultValue="America/Chicago"/>
	  <parameter name="P_CURRENT_TIME" dataType="varchar"/>
	  <parameter name="P_OBJECT_NAME" dataType="varchar" defaultValue="SCOULAR/NVO.01242"/>
	  </parameters>
   
   <lexicals/>
   
   <dataQuery>
    	  
      <sqlStatement name="GTM_TRANSACTION_SRC">
         <![CDATA[SELECT GTM_TRANSACTION.GTM_TRANSACTION_GID GTM_TRANSACTION_GID, GTM_TRANSACTION_XID, DATA_QUERY_TYPE_GID, OBJECT_ID,
					CARRIER_CODE, CONVEYANCE_NAME, CONVEYANCE_FLAG, GTM_TRANSACTION.TRANSPORT_MODE_GID TRANSPORT_MODE_GID, X12_FORMAT_CODE,
					INCO_TERM_GID,  INCO_TERM_LOCATION,  IS_HAZARDOUS_CARGO,
					(SELECT STATUS_VALUE_XID
					FROM GLOGOWNER.GTM_TRANS_REQD_STATUS, GLOGOWNER.STATUS_VALUE, GLOGOWNER.STATUS_TYPE
					WHERE GTM_TRANS_REQD_STATUS.GTM_TRANSACTION_GID = GTM_TRANSACTION.GTM_TRANSACTION_GID
					AND GTM_TRANS_REQD_STATUS.STATUS_TYPE_GID = STATUS_VALUE.STATUS_TYPE_GID
					AND GTM_TRANS_REQD_STATUS.STATUS_VALUE_GID = STATUS_VALUE.STATUS_VALUE_GID
					AND STATUS_VALUE.STATUS_TYPE_GID = STATUS_TYPE.STATUS_TYPE_GID
					AND DOCUMENT_DEF_GID = :P_DOCUMENT_DEF_GID
					AND STATUS_TYPE_XID = 'SHIPMENT_CUSTOMS_STATE') AS SHIPMENT_CUSTOMS_STATE,
					(SELECT STATUS_VALUE_XID
					FROM GLOGOWNER.GTM_TRANS_REQD_STATUS, GLOGOWNER.STATUS_VALUE, GLOGOWNER.STATUS_TYPE
					WHERE GTM_TRANS_REQD_STATUS.GTM_TRANSACTION_GID = GTM_TRANSACTION.GTM_TRANSACTION_GID
					AND GTM_TRANS_REQD_STATUS.STATUS_TYPE_GID = STATUS_VALUE.STATUS_TYPE_GID
					AND GTM_TRANS_REQD_STATUS.STATUS_VALUE_GID = STATUS_VALUE.STATUS_VALUE_GID
					AND STATUS_VALUE.STATUS_TYPE_GID = STATUS_TYPE.STATUS_TYPE_GID
					AND DOCUMENT_DEF_GID = :P_DOCUMENT_DEF_GID
					AND STATUS_TYPE_XID = 'CUSTOMS_FILING') AS CUSTOMS_FILING_STATUS,
					(SELECT TO_CHAR(SYSDATE,'YYYYMMDDHHMM') FROM DUAL) as INTERCHANGE_DATE ,
					(SELECT REFNUM_VALUE FROM GLOGOWNER.GTM_TRANS_REFNUM GTR
					WHERE GTR.GTM_TRANSACTION_GID = GTM_TRANSACTION.GTM_TRANSACTION_GID
					AND GTM_TRANS_REFNUM_QUAL_GID = :P_REPORTING_REFERENCE_NUMBER) REPORTING_REFERENCE_NUMBER
					FROM GLOGOWNER.GTM_TRANSACTION LEFT OUTER JOIN GLOGOWNER.TRANSPORT_MODE ON (GTM_TRANSACTION.TRANSPORT_MODE_GID = TRANSPORT_MODE.TRANSPORT_MODE_GID)
WHERE   GTM_TRANSACTION.GTM_TRANSACTION_GID = :P_GTM_SHIPMENT_ID
]]>
     </sqlStatement>
  
     <sqlStatement name="GTM_TRANSACTION_INVOLVED_PARTY_SRC">
         <![CDATA[SELECT GTIP.INVOLVED_PARTY_QUAL_GID INVOLVED_PARTY_QUAL_GID, INVOLVED_PARTY_CONTACT_GID, CONTACT_XID,
				FIRST_NAME, LAST_NAME, PHONE1, PHONE2, FAX, MIDDLE_NAME, CELL_PHONE, ALTERNATE_NAME, COMPANY_NAME,
				LOCATION.LOCATION_GID LOCATION_GID, LOCATION_XID, LOCATION_NAME, CITY, PROVINCE, PROVINCE_CODE, POSTAL_CODE, 
				LOCATION.COUNTRY_CODE3_GID COUNTRY_CODE3_GID, COUNTRY_CODE3_XID, COUNTRY_CODE2, null as SCAC_GID,
				(SELECT  REFNUM_VALUE FROM GLOGOWNER.GTM_PARTY_REFNUM GPR1 WHERE GPR1.CONTACT_GID = GTIP.INVOLVED_PARTY_CONTACT_GID
				AND GPR1.GTM_PARTY_REFNUM_QUAL_GID = 'DDTC REGISTRATION NUMBER') AS DDTC_REGISTRATION_NUMBER,
				(SELECT  REMARK_TEXT FROM GLOGOWNER.GTM_PARTY_REMARK GPR2 WHERE GPR2.CONTACT_GID = GTIP.INVOLVED_PARTY_CONTACT_GID
				AND GPR2.REMARK_QUAL_GID = 'ELIGIBLE PARTY CERTIFICATION') AS ELIGIBLE_PARTY_CERTIFICATION,
				(SELECT  REFNUM_VALUE FROM GLOGOWNER.GTM_PARTY_REFNUM GPR3 WHERE GPR3.CONTACT_GID = GTIP.INVOLVED_PARTY_CONTACT_GID
				AND GPR3.GTM_PARTY_REFNUM_QUAL_GID = 'ACID') AS ACID,
				(SELECT REFNUM_VALUE FROM GLOGOWNER.GTM_PARTY_REFNUM
			 			WHERE GTM_PARTY_REFNUM_QUAL_GID ='EIN' 
			 			AND CONTACT_GID = CONTACT.CONTACT_GID) EIN, 
				(SELECT REFNUM_VALUE FROM GLOGOWNER.GTM_PARTY_REFNUM
			 			WHERE GTM_PARTY_REFNUM_QUAL_GID ='DUNS' 
			 			AND CONTACT_GID = CONTACT.CONTACT_GID) DUNS, 
				(SELECT REFNUM_VALUE FROM GLOGOWNER.GTM_PARTY_REFNUM
			 			WHERE GTM_PARTY_REFNUM_QUAL_GID = :P_REPORTING_FOREIGN_ENTITY
			 			AND CONTACT_GID = CONTACT.CONTACT_GID) FOREIGN_ENTITY,
				(SELECT GTM_CODE FROM GLOGOWNER.GTM_PARTY_CODE
						WHERE GTM_TYPE_GID ='ULTIMATE CONSIGNEE TYPE' 
						AND CONTACT_GID = CONTACT.CONTACT_GID) UTLIMATE_CONSIGNEE_TYPE
FROM GLOGOWNER.GTM_TRANSACTION_INVOLVED_PARTY GTIP, 
      GLOGOWNER.CONTACT LEFT OUTER JOIN GLOGOWNER.LOCATION ON (CONTACT.LOCATION_GID = LOCATION.LOCATION_GID) 
	  LEFT OUTER JOIN GLOGOWNER.COUNTRY_CODE ON (LOCATION.COUNTRY_CODE3_GID = COUNTRY_CODE.COUNTRY_CODE3_GID)
WHERE GTIP.INVOLVED_PARTY_CONTACT_GID = CONTACT.CONTACT_GID
AND  GTIP.INVOLVED_PARTY_QUAL_GID IN ('ULTIMATE CONSIGNEE', 'FORWARDING AGENT', 'INTERMEDIATE CONSIGNEE', 'USPPI')
AND GTIP.GTM_TRANSACTION_GID = :P_GTM_CUSTOMS_ID
AND ROWNUM <= 10
UNION
SELECT GTIP.INVOLVED_PARTY_QUAL_GID INVOLVED_PARTY_QUAL_GID, INVOLVED_PARTY_CONTACT_GID, CONTACT_XID,
		FIRST_NAME, LAST_NAME, PHONE1, PHONE2, FAX, MIDDLE_NAME, CELL_PHONE, ALTERNATE_NAME, COMPANY_NAME,
		LOCATION.LOCATION_GID LOCATION_GID, LOCATION_XID, LOCATION_NAME, CITY, PROVINCE, PROVINCE_CODE, POSTAL_CODE, 
		LOCATION.COUNTRY_CODE3_GID COUNTRY_CODE3_GID, COUNTRY_CODE3_XID, COUNTRY_CODE2,  null, null, null, null, null, null,null,null
FROM GLOGOWNER.GTM_TRANSACTION_INVOLVED_PARTY GTIP, 
      GLOGOWNER.CONTACT LEFT OUTER JOIN GLOGOWNER.LOCATION ON (CONTACT.LOCATION_GID = LOCATION.LOCATION_GID) 
	  LEFT OUTER JOIN GLOGOWNER.COUNTRY_CODE ON (LOCATION.COUNTRY_CODE3_GID = COUNTRY_CODE.COUNTRY_CODE3_GID)
WHERE GTIP.INVOLVED_PARTY_CONTACT_GID = CONTACT.CONTACT_GID
AND  GTIP.INVOLVED_PARTY_QUAL_GID = 'SHIP_FROM'
AND GTIP.GTM_TRANSACTION_GID = :P_GTM_CUSTOMS_ID
UNION
SELECT GTIP.INVOLVED_PARTY_QUAL_GID INVOLVED_PARTY_QUAL_GID, INVOLVED_PARTY_CONTACT_GID, CONTACT_XID,
		FIRST_NAME, LAST_NAME, PHONE1, PHONE2, FAX, MIDDLE_NAME, CELL_PHONE, ALTERNATE_NAME, COMPANY_NAME,
		LOCATION.LOCATION_GID LOCATION_GID, LOCATION_XID, LOCATION_NAME, CITY, PROVINCE, PROVINCE_CODE, POSTAL_CODE, 
		LOCATION.COUNTRY_CODE3_GID COUNTRY_CODE3_GID, COUNTRY_CODE3_XID, COUNTRY_CODE2, SERVPROV.SCAC_GID SCAC_GID, null, null, null, null, null,null,null
FROM GLOGOWNER.GTM_TRANSACTION_INVOLVED_PARTY GTIP, 
      GLOGOWNER.CONTACT LEFT OUTER JOIN GLOGOWNER.LOCATION ON (CONTACT.LOCATION_GID = LOCATION.LOCATION_GID) 
						LEFT OUTER JOIN GLOGOWNER.COUNTRY_CODE ON (LOCATION.COUNTRY_CODE3_GID = COUNTRY_CODE.COUNTRY_CODE3_GID)
						LEFT OUTER JOIN GLOGOWNER.SERVPROV ON (CONTACT.CONTACT_GID = SERVPROV.SERVPROV_GID)
WHERE GTIP.INVOLVED_PARTY_CONTACT_GID = CONTACT.CONTACT_GID
AND  GTIP.INVOLVED_PARTY_QUAL_GID = 'CARRIER'
AND GTIP.GTM_TRANSACTION_GID = :P_GTM_CUSTOMS_ID
]]>
 
      </sqlStatement>
	  
	   <sqlStatement name="GTM_TRANSACTION_PORT_SRC">
         <![CDATA[SELECT LOCATION_REFNUM_VALUE AS SCHEDULE_D_CODE,
				(SELECT LOCATION_REFNUM_VALUE FROM LOCATION_REFNUM, LOCATION_REFNUM_QUAL
				WHERE LOCATION_REFNUM.LOCATION_REFNUM_QUAL_GID = LOCATION_REFNUM_QUAL.LOCATION_REFNUM_QUAL_GID
				AND LOCATION_REFNUM.LOCATION_GID = (SELECT PORT_OF_LOAD_LOCATION_GID from shipment where shipment_gid =
				:P_OBJECT_NAME)	AND LOCATION_REFNUM_QUAL.LOCATION_REFNUM_QUAL_XID = 'SCHEDULE_K') SCHEDULE_K_CODE
                FROM LOCATION_REFNUM, LOCATION_REFNUM_QUAL
				WHERE LOCATION_REFNUM.LOCATION_REFNUM_QUAL_GID = LOCATION_REFNUM_QUAL.LOCATION_REFNUM_QUAL_GID
				AND LOCATION_REFNUM.LOCATION_GID = (SELECT dest_location_gid from shipment where shipment_gid =
				:P_OBJECT_NAME)
				AND LOCATION_REFNUM_QUAL.LOCATION_REFNUM_QUAL_XID = 'SCHEDULE_D'         
]]>
      </sqlStatement>
	  	  
	   <sqlStatement name="GTM_CHARTER_VOYAGE_SRC">
         <![CDATA[SELECT CHARTER_VOYAGE.VOYAGE_NAME,TO_CHAR(CHARTER_VOYAGE.ESTIMATED_ARRIVAL_DATE,'YYYYMMDD') AS ESTIMATED_ARRIVAL_DATE
			FROM CHARTER_VOYAGE
			LEFT OUTER JOIN GTM_TRANS_REFNUM ON CHARTER_VOYAGE_XID=REFNUM_VALUE 
			WHERE GTM_TRANSACTION_GID=:P_GTM_SHIPMENT_ID AND CHARTER_VOYAGE_TYPE='CHARTERED'
]]>
		</sqlStatement>
		<sqlStatement name="GTM_TRANSACTION_DATE_SRC">
         <![CDATA[SELECT TO_CHAR(TRANSACTION_DATE,'YYYYMMDD') AS ESTIMATED_ARRIVAL_DATE
			FROM GTM_TRANSACTION_DATE
			WHERE GTM_TRANSACTION_GID=:P_GTM_CUSTOMS_ID AND DATE_QUALIFIER_GID='SCHEDULED_ARRIVAL_DATE'
]]>
		</sqlStatement>	
		<sqlStatement name="GTM_CHARTER_VOYAGE_REFNUM_SRC">
         <![CDATA[Select CVR.CHARTER_VOYAGE_REFNUM_VALUE
			from gtm_trans_refnum 
			JOIN CHARTER_VOYAGE CV ON REFNUM_VALUE=CHARTER_VOYAGE_XID
			JOIN CHARTER_VOYAGE_REFNUM CVR ON CVR.CHARTER_VOYAGE_GID=CV.CHARTER_VOYAGE_GID 
			where gtm_transaction_gid=:P_GTM_SHIPMENT_ID AND GTM_TRANS_REFNUM_QUAL_GID='CHARTER VOYAGE' 
			AND CHARTER_VOYAGE_REFNUM_QUAL_GID='SCOULAR.CHARVOY_VOYAGE_NUMBER'     
]]>	
	</sqlStatement>
	<sqlStatement name="GTM_MANIFEST_TYPE_CODE_SRC">
         <![CDATA[Select 'W' as MANIFEST_TYPE_CODE
			FROM GTM_CATEGORY
			WHERE GTM_CATEGORY_GID='AMS FILING'			 
]]>	
	</sqlStatement>
	
   </dataQuery>
   
   <dataStructure>		
		<group name="GTM_SHIPMENT" dataType="varchar2" source="GTM_TRANSACTION_SRC">
			
			<element name="GTM_SHIPMENT_GID" dataType="varchar2" value="GTM_TRANSACTION_GID"/>
			<element name="GTM_SHIPMENT_XID" dataType="varchar2" value="GTM_TRANSACTION_XID"/>
			<element name="DATA_QUERY_TYPE_GID" dataType="varchar2" value="DATA_QUERY_TYPE_GID"/>
			<element name="OBJECT_ID" dataType="varchar2" value="OBJECT_ID"/>
			<element name="CARRIER_CODE" dataType="varchar2" value="CARRIER_CODE"/>
			<element name="CONVEYANCE_NAME" dataType="varchar2" value="CONVEYANCE_NAME"/>
			<element name="CONVEYANCE_FLAG" dataType="varchar2" value="CONVEYANCE_FLAG"/>
			<element name="TRANSPORT_MODE_GID" dataType="varchar2" value="TRANSPORT_MODE_GID"/>
			<element name="X12_TRANSPORT_MODE_CODE" dataType="varchar2" value="X12_FORMAT_CODE"/>			
			<element name="INCO_TERM_GID" dataType="varchar2" value="INCO_TERM_GID"/>
			<element name="INCO_TERM_LOCATION" dataType="varchar2" value="INCO_TERM_LOCATION"/>
			<element name="IS_HAZARDOUS_CARGO" dataType="varchar2" value="IS_HAZARDOUS_CARGO"/>
			<element name="SHIPMENT_CUSTOMS_STATE" dataType="varchar2" value="SHIPMENT_CUSTOMS_STATE"/>
			<element name="CUSTOMS_FILING_STATUS" dataType="varchar2" value="CUSTOMS_FILING_STATUS"/>
			<element name="REPORTING_REFERENCE_NUMBER" dataType="varchar2" value="REPORTING_REFERENCE_NUMBER"/>
			<element name="INTERCHANGE_DATE" dataType="varchar2" value="INTERCHANGE_DATE"/>
			<element name="LX_SEQUENCE" dataType="varchar2" value="LX"/>
									
			<group name="GTM_SHIPMENT_INVOLVED_PARTY" dataType="varchar2" source="GTM_TRANSACTION_INVOLVED_PARTY_SRC">
				<element name="INVOLVED_PARTY_QUAL_GID" dataType="varchar2" value="INVOLVED_PARTY_QUAL_GID"/>
				<element name="CONTACT_GID" dataType="varchar2" value="INVOLVED_PARTY_CONTACT_GID"/>
				<element name="CONTACT_XID" dataType="varchar2" value="CONTACT_XID"/>
				<element name="FIRST_NAME" dataType="varchar2" value="FIRST_NAME"/>
				<element name="LAST_NAME" dataType="varchar2" value="LAST_NAME"/>
				<element name="MIDDLE_NAME" dataType="varchar2" value="MIDDLE_NAME"/>
				<element name="PHONE1" dataType="varchar2" value="PHONE1"/>
				<element name="PHONE2" dataType="varchar2" value="PHONE2"/>
				<element name="FAX" dataType="varchar2" value="FAX"/>
				<element name="CELL_PHONE" dataType="varchar2" value="CELL_PHONE"/>
				<element name="ALTERNATE_NAME" dataType="varchar2" value="ALTERNATE_NAME"/>
				<element name="COMPANY_NAME" dataType="varchar2" value="COMPANY_NAME"/>
				<element name="LOCATION_GID" dataType="varchar2" value="LOCATION_GID"/>				
				<element name="LOCATION_XID" dataType="varchar2" value="LOCATION_XID"/>
				<element name="LOCATION_NAME" dataType="varchar2" value="LOCATION_NAME"/>
				<element name="CITY" dataType="varchar2" value="CITY"/>
				<element name="PROVINCE" dataType="varchar2" value="PROVINCE"/>
				<element name="PROVINCE_CODE" dataType="varchar2" value="PROVINCE_CODE"/>
				<element name="POSTAL_CODE" dataType="varchar2" value="POSTAL_CODE"/>
				<element name="COUNTRY_CODE3_GID" dataType="varchar2" value="COUNTRY_CODE3_GID"/>
				<element name="COUNTRY_CODE3_XID" dataType="varchar2" value="COUNTRY_CODE3_XID"/>
				<element name="COUNTRY_CODE2" dataType="varchar2" value="COUNTRY_CODE2"/>
				<element name="SCAC_GID" dataType="varchar2" value="SCAC_GID"/>
				<element name="DDTC_REGISTRATION_NUMBER" dataType="varchar2" value="DDTC_REGISTRATION_NUMBER"/>
				<element name="ELIGIBLE_PARTY_CERTIFICATION" dataType="varchar2" value="ELIGIBLE_PARTY_CERTIFICATION"/>
				<element name="ACID" dataType="varchar2" value="ACID"/>
				<element name="EIN" dataType="varchar2" value="EIN"/>
				<element name="DUNS" dataType="varchar2" value="DUNS"/>
				<element name="FOREIGN_ENTITY" dataType="varchar2" value="FOREIGN_ENTITY"/>
				<element name="UTLIMATE_CONSIGNEE_TYPE" dataType="varchar2" value="UTLIMATE_CONSIGNEE_TYPE"/>
				</group>
			
			<group name="GTM_CHARTER_VOYAGE_REFNUM" dataType="varchar2" source="GTM_CHARTER_VOYAGE_REFNUM_SRC">		
				<element name="CHARTER_VOYAGE_REFNUM_VALUE" dataType="varchar2" value="CHARTER_VOYAGE_REFNUM_VALUE"/>
			</group>
			<group name="GTM_MANIFEST_TYPE_CODE" dataType="varchar2" source="GTM_MANIFEST_TYPE_CODE_SRC">		
				<element name="MANIFEST_TYPE_CODE" dataType="varchar2" value="MANIFEST_TYPE_CODE"/>
			</group>
			<group name="GTM_TRANSACTION_PORT" dataType="varchar2" source="GTM_TRANSACTION_PORT_SRC">
				<element name="SCHEDULE_D_CODE" dataType="varchar2" value="SCHEDULE_D_CODE"/>
				<element name="SCHEDULE_K_CODE" dataType="varchar2" value="SCHEDULE_K_CODE"/>
			</group>
		    <group name="GTM_TRANSACTION_DATE" dataType="varchar2" source="GTM_TRANSACTION_DATE_SRC">		
			    <element name="ESTIMATED_ARRIVAL_DATE" dataType="varchar2" value="ESTIMATED_ARRIVAL_DATE"/>
			</group>
			<group name="GTM_CHARTER_VOYAGE" dataType="varchar2" source="GTM_CHARTER_VOYAGE_SRC">		
				<element name="VOYAGE_NAME" dataType="varchar2" value="VOYAGE_NAME"/>
			    <element name="ESTIMATED_ARRIVAL_DATE" dataType="varchar2" value="ESTIMATED_ARRIVAL_DATE"/>
			</group>
		</group>	
   </dataStructure>
   
</dataTemplate>
